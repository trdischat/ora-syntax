{
  "$schema": "https://raw.githubusercontent.com/martinring/tmlanguage/master/tmlanguage.json",
  "name": "ORA Templating Language",
  "scopeName": "source.ora",
  "patterns": [
    { "include": "#component" }
  ],
  "repository": {
    "component": {
      "patterns": [
        {
          "name": "comment.line.number-sign.ora",
          "match": "^#.*$"
        },
        {
          "name": "constant.character.escape.ora",
          "match": "\\\\[<#>\\[\\]\\/\\\\]"
        },
        { "include": "#multitest" },
        { "include": "#compare" },
        { "include": "#assign" },
        { "include": "#lookback" },
        { "include": "#field" },
        { "include": "#conditional" },
        { "include": "#control" }
      ]
    },
    "control": {
      "match": "\\{[\\w\\:\\+\\*-=]+\\}",
      "name": "string.control.ora"
    },
    "conditional": {
      "begin": "<",
      "end": ">",
      "beginCaptures": {
        "0": {
          "name": "keyword.conditional.ora"
        }
      },
      "endCaptures": {
        "0": {
          "name": "keyword.conditional.ora"
        }
      },
      "patterns": [
        { "include": "#component" },
        {
          "match": "\\|",
          "name": "keyword.conditional.ora"
        }
      ]
    },
    "multitest": {
      "name": "multitest.ora",
      "begin": "\\[(\\?\\?)\\:",
      "end": "\\]",
      "beginCaptures": {
        "1": {
          "name": "keyword.operator.ora"
        }
      },
      "patterns": [
        {
          "match": "[^=:<!>\\/\\]]+",
          "name": "variable.ora"
        }
      ]
    },
    "compare": {
      "name": "compare.ora",
      "begin": "\\[(\\?)\\:",
      "end": "\\]",
      "beginCaptures": {
        "1": {
          "name": "keyword.operator.ora"
        }
      },
      "patterns": [
        {
          "match": "(?<=\\?\\:)[^=:<!>\\/\\]]+",
          "name": "variable.ora"
        },
        {
          "match": "\\/[^\\/]+\\/",
          "name": "string.regexp.ora"
        },
        {
          "match": "[=!<>]{1,3}",
          "name": "keyword.operator.ora"
        },
        { "include": "#component" }
      ]
    },
    "assign": {
      "name": "assign.ora",
      "begin": "\\[(\\={1,2})\\:",
      "end": "\\]",
      "beginCaptures": {
        "1": {
          "name": "keyword.operator.ora"
        }
      },
      "patterns": [
        {
          "match": "(?<=\\=\\:)[^=:<!>\\/\\]]+",
          "name": "variable.ora"
        },
        { "include": "#component" }
      ]
    },
    "lookback": {
      "name": "lookback.ora",
      "begin": "\\[([\\+\\-])\\:",
      "end": "\\]",
      "beginCaptures": {
        "1": {
          "name": "keyword.operator.ora"
        }
      },
      "patterns": [
        { "include": "#component" }
      ]
    },
    "field": {
      "name": "field.ora",
      "begin": "\\[(?=[^=:<!>\\/\\]])",
      "end": "\\]",
      "patterns": [
        {
          "match": "(?<=\\[)[^=:<!>\\/\\]]+",
          "name": "variable.ora"
        },
        { "include": "#ORATransforms" },
        { "include": "#regexParams" },
        { "include": "#component"},
        {
          "match": "(?<=\\:)[^:\\]]+",
          "name": "string.parameter.ora"
        }
      ]
    },
    "regexParams": {
      "begin": "(?<=(?:extract|extractIndex|replace))\\:",
      "end": "[\\:\\]]",
      "patterns": [
        {
          "match": "\\(\\?\\:",
          "name": "string.regexp.ora"
        },
        {
          "match": "[^\\[\\]\\:]+",
          "name": "string.regexp.ora"
        },
        { "include": "#regexSet" }
      ]
    },
    "regexSet": {
        "begin": "\\[",
        "end": "\\]",
        "patterns": [
          {
            "match": "[^\\[\\]]+"
          },
          { "include": "#regexSet"}
        ],
        "name": "string.regexp.ora"
    },
    "ORATransforms": {
      "name": "support.function.ora",
      "match": "(?<=\\:)(?:age|ageDays|ageMonths|ageYears|date|dateAdd|dateDay|dateDifference|dateGtoJ|dateJtoG|dateJNYD|dateMDSwap|dateModifier|dateMonth|dateMonthAbbr|dateMonthName|dateQuarter|dateSubtract|dateYear|dayOfWeek|dateFrench|dateGerman|dateItalian|dateSpanish|attribute|query|queryInner|queryValue|capitalize|initialCapital|isLowerCase|isMixedCase|isUpperCase|lowercase|uppercase|mathAbs|mathAdd|mathCeiling|mathDivide|mathFloor|mathMultiply|mathRound|mathSubtract|namePrefix|namePrefixRaw|nameGiven|nameGivenRaw|nameSurname|nameSurnameRaw|nameSuffix|nameSuffixRaw|nameToGivenFirst|placeDetail|placeCity|placeCounty|placeDistrict|placeState|placeProvince|placeCountry|placePostalCode|placeHasDetail|placeHasCity|placeHasCounty|placeHasDistrict|placeHasState|placeHasProvince|placeHasCountry|placeHasPostalCode|placeAddCountry|placeLocale|abbr|abbrSplit|full|fullSplit|lookup|lookupSplit|append|extract|extractIndex|hrefToUrl|initials|length|numberToWords|padLeft|padRight|plural|prepend|replace|reverse|split|splitCount|splitLines|splitLinesCount|substring|urlParameter)\\b"
    }
  }
}
